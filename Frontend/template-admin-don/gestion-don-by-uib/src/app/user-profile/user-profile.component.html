<mat-card class="assoc-card">
  <div class="layout">
    <!-- Colonne gauche : avatar + upload -->
    <aside class="side">
      <img
        class="avatar"
        [src]="photoPreview || profileForm.value.photo || 'assets/img/default-avatar.png'"
        alt="Logo association"
      />
      <h3 class="name">{{ profileForm.value.nom_complet || 'Association' }}</h3>
      <p class="email">{{ profileForm.value.email }}</p>

      <button mat-stroked-button type="button" (click)="photoInput.click()">
        <mat-icon>photo_camera</mat-icon>&nbsp;Changer la photo
      </button>
      <input #photoInput hidden type="file" accept="image/*" (change)="onFileSelected($event)" />
    </aside>

    <!-- Colonne droite : formulaire -->
    <section class="content">
      <h2>Modifier Profil Association</h2>
     

      <form class="form-grid" [formGroup]="profileForm" (ngSubmit)="updateProfile()">
        <h3 class="section">Informations</h3>

        <mat-form-field appearance="outline">
          <mat-label>Nom complet</mat-label>
          <input matInput formControlName="nom_complet" />
          <mat-icon matSuffix>badge</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" />
          <mat-icon matSuffix>alternate_email</mat-icon>
        </mat-form-field>

        <mat-form-field class="full" appearance="outline">
          <mat-label>Description</mat-label>
          <textarea matInput rows="3" formControlName="description_association"></textarea>
          <mat-icon matSuffix>edit</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Téléphone</mat-label>
          <input matInput formControlName="telephone" />
          <mat-icon matSuffix>call</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Adresse</mat-label>
          <input matInput formControlName="adresse" />
          <mat-icon matSuffix>place</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Type d'association</mat-label>
          <mat-select formControlName="type_association">
            <mat-option *ngFor="let t of typesAssociation" [value]="t">{{ t }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Gouvernorat</mat-label>
          <mat-select formControlName="gouvernorat_id">
            <mat-option *ngFor="let g of gouvernorats" [value]="g.id">
              {{ g.nomGouvernorat }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Matricule fiscal</mat-label>
          <input matInput formControlName="matricule_fiscal" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Relevé RIB</mat-label>
          <input matInput formControlName="releve_rib" />
        </mat-form-field>

        <div class="file-line full">
          <div>
            <span class="file-label">Carte d'identité fiscale</span>
          </div>
          <div>
            <button mat-stroked-button type="button" (click)="cinInput.click()">
              <mat-icon>upload_file</mat-icon>&nbsp;Téléverser
            </button>
            <input #cinInput hidden type="file" (change)="onCinFiscaleSelected($event)" />
          </div>
        </div>

        <h3 class="section">Sécurité</h3>

        <mat-form-field appearance="outline">
          <mat-label>Ancien mot de passe</mat-label>
          <input matInput [type]="showOld ? 'text' : 'password'" formControlName="old_password" />
          <button mat-icon-button type="button" matSuffix (click)="showOld = !showOld">
            <mat-icon>{{ showOld ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Nouveau mot de passe</mat-label>
          <input matInput [type]="showNew ? 'text' : 'password'" formControlName="new_password" />
          <button mat-icon-button type="button" matSuffix (click)="showNew = !showNew">
            <mat-icon>{{ showNew ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-hint>6+ caractères, 1 maj., 1 chiffre, 1 spécial</mat-hint>
        </mat-form-field>

        <div class="actions full">
          <button mat-stroked-button type="button" (click)="resetForm()">Annuler</button>
          <button mat-flat-button color="primary" type="submit" [disabled]="profileForm.pristine">>
            Enregistrer
          </button>
        </div>
      </form>

      <p *ngIf="message" class="info">{{ message }}</p>
    </section>
  </div>
</mat-card>

<h2 mat-dialog-title class="title">
  <mat-icon>article</mat-icon>
  Détails de la publication
</h2>

<mat-dialog-content class="content">
  <ng-container *ngIf="publication; else loadingOrError">
    <h3 class="pub-title">{{ publication.titre }}</h3>
    <p class="pub-contenu">{{ publication.contenu }}</p>

    <mat-divider></mat-divider>

    <div class="meta">
      <div><strong>Date :</strong> {{ publication.date_publication | date }}</div>
      <div><strong>Likes :</strong> {{ publication.nb_likes }}</div>
      <div><strong>Commentaires :</strong> {{ publication.nb_commentaires }}</div>
    </div>

    <h4 class="comments-title">Commentaires</h4>

    <ng-container *ngIf="publication.commentaires?.length > 0; else noComments">
      <ul class="comments">
        <li *ngFor="let c of publication.commentaires">
          <span class="bullet">•</span>
          <span class="text">
            <mat-icon class="bubble" inline>chat_bubble_outline</mat-icon>
            {{ c.contenu }}
            <span class="author">— {{ c.nom_donateur }}</span>
            <span class="date"> ({{ c.date_commentaire | date }})</span>
          </span>
          <span
            class="badge"
            [ngClass]="{
              'badge-success': c.sentiment === 'positif',
              'badge-warning': c.sentiment === 'neutre',
              'badge-danger': c.sentiment === 'négatif'
            }"
          >
            {{ c.sentiment }}
          </span>
        </li>
      </ul>
    </ng-container>

    <ng-template #noComments>
      <p class="muted">Aucun commentaire pour le moment.</p>
    </ng-template>
  </ng-container>

  <ng-template #loadingOrError>
    <p *ngIf="!error" class="muted">Chargement…</p>
    <p *ngIf="error" class="error">{{ error }}</p>
  </ng-template>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button color="primary" (click)="close()">Fermer</button>
</mat-dialog-actions>
